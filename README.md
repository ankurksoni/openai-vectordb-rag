# openai-vectordb-rag

## Motive
A simple, modular Retrieval-Augmented Generation (RAG) playground using OpenAI, ChromaDB, and pgvector. The goal is to demonstrate and compare vector search and RAG pipelines using both a vector database (ChromaDB) and a Postgres extension (pgvector).

## Architecture
- **Data Ingestion:** Example data is embedded using OpenAI's embedding models.
- **Vector Storage:** Embeddings are stored in either ChromaDB (NoSQL vector DB) or Postgres with pgvector.
- **Retrieval:** User queries are embedded and matched against stored vectors for context retrieval.
- **Generation:** Retrieved context is sent to OpenAI's GPT model for answer generation.
- **Entry Points:**  
  - `src/chromadb.ts`: RAG pipeline using ChromaDB.
  - `src/pgvector.ts`: RAG pipeline using Postgres + pgvector.

## Tech Stack
- **Node.js** (TypeScript)
- **OpenAI API** (text-embedding, chat-completions)
- **ChromaDB** (vector database, via Docker)
- **Postgres + pgvector** (vector search in SQL, via Docker)
- **tiktoken** (token counting)
- **ts-node** (dev)
- **Docker Compose** (for local DBs)

## Main Packages
- `chromadb`
- `openai`
- `pg`
- `pgvector`
- `tiktoken`
- `@types/node`, `@types/pg`, `ts-node` (dev)

## Setup & Running

### Prerequisites
- Node.js 18+
- Docker & Docker Compose
- OpenAI API key

### 1. Install dependencies
```bash
npm install
```

### 2. Start vector DBs (in another terminal)
```bash
docker-compose up
```

### 3. Set up environment variables
Create a `.env` file:
```
OPENAI_API_KEY=your-key
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/postgres
```

### 4. Run scripts

- **ChromaDB RAG:**
  ```bash
  npm run start:chromadb
  ```
- **pgvector RAG:**
  ```bash
  npm run start:pgvector
  ```
- **OpenAI function-calling demo:**
  ```bash
  npm start
  ```

## What Happens When You Run Each Script

### ChromaDB RAG (`npm run start:chromadb`)
1. **Builds the project** (TypeScript to JS).
2. **Starts** `src/chromadb.ts`:
   - Creates a ChromaDB collection (if not exists).
   - Embeds example data using OpenAI and stores it in ChromaDB.
   - Prompts you for a question in the terminal.
   - Finds the most relevant info using vector search.
   - Uses OpenAI GPT to answer your question based on the found context.
   - **Output:** The answer is printed in the terminal.

### pgvector RAG (`npm run start:pgvector`)
1. **Builds the project** (TypeScript to JS).
2. **Starts** `src/pgvector.ts`:
   - Connects to Postgres and ensures the `vector` extension/table exists.
   - Embeds and inserts example data into the database.
   - Prompts you for a question in the terminal.
   - Finds the most relevant info using pgvector similarity search.
   - Uses OpenAI GPT to answer your question based on the found context.
   - **Output:** The answer is printed in the terminal.

## How to Interpret the Code & Outputs (For Newbies)
- **Where to look:**
  - Main logic for each pipeline is in `src/chromadb.ts` and `src/pgvector.ts`.
  - Each script is self-contained and can be run independently.
- **What you see in the terminal:**
  - You'll be prompted to enter a question.
  - The script will print the answer generated by OpenAI, using the most relevant context it found.
- **How it works:**
  - Data is embedded (turned into vectors) and stored in a vector DB (ChromaDB or Postgres).
  - When you ask a question, it is also embedded and compared to stored vectors to find the best match.
  - The matched context is sent to OpenAI's GPT model to generate a final answer.
- **To experiment:**
  - Change the example data in the scripts to see how answers change.
  - Try different questions to see how retrieval and generation work.
- **If you get errors:**
  - Make sure Docker containers for ChromaDB/Postgres are running.
  - Check your `.env` file for correct API keys and DB URLs.

## Key Concepts Explained (RAG, AI, Embeddings, Vector DB)

### What is RAG (Retrieval-Augmented Generation)?
RAG is a technique where an AI model (like GPT) is given extra information retrieved from a database to answer your question more accurately.

**Example:**
- You ask: "Who is Alexandra Thompson?"
- The system first searches its database for info about Alexandra.
- It finds: "Alexandra Thompson, a 19-year-old computer science sophomore..."
- This info is sent to the AI model, which then answers your question using it.

### What is AI (Artificial Intelligence)?
AI is software that can perform tasks that usually require human intelligence, like understanding language, answering questions, or making decisions.

**Example:**
- You type: "What is the capital of France?"
- The AI reads your question and replies: "Paris."

### What are Embeddings?
Embeddings are a way to turn text into numbers (vectors) so computers can compare meanings efficiently.

**Example:**
- "cat" and "kitten" will have similar embeddings (numbers close together), while "cat" and "car" will be far apart.

### What is a Vector Database?
A vector database stores these embeddings and lets you quickly find the most similar ones to a new question.

**Example:**
- You ask: "Tell me about the chess club."
- The system finds the stored info whose embedding is closest to your question's embedding.

## RAG Flow (Input to Output)

```mermaid
flowchart TD
    A[User Question] --> B[Embed Question (OpenAI)]
    B --> C[Vector Search (ChromaDB/pgvector)]
    C --> D[Retrieve Relevant Context]
    D --> E[Send Context + Question to GPT]
    E --> F[AI Generates Answer]
    F --> G[Show Answer to User]
```

![RAG Flowchart](https://github.com/ankurksoni/openai-vectordb-rag/flowchart.png)

## Why ChromaDB and pgvector?

This project uses both ChromaDB and pgvector to demonstrate and compare two popular approaches to vector search:

- **ChromaDB** is a purpose-built, high-performance vector database. It is designed for fast, scalable similarity search and is easy to run locally with Docker. ChromaDB is great for projects focused solely on vector search and retrieval-augmented generation (RAG) pipelines.

- **pgvector** is a PostgreSQL extension that adds vector search capabilities to a traditional SQL database. This allows you to combine the power of relational data with vector search in a single system. pgvector is ideal if you want to add AI-powered search to existing Postgres-backed applications or need strong consistency and transactional support.

By including both, this repo helps you:
- See the trade-offs and strengths of each approach
- Learn how to implement RAG with either a dedicated vector DB or a familiar SQL database
- Experiment and choose the best fit for your own use case
